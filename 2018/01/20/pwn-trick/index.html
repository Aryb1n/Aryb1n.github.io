<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.0 -->
    <script>
        window.materialVersion = "1.5.0"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">

    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source"/>














    <!-- Title -->
    
    <title>
        
            pwn | trick | 
        
        Aryb1n&#39;s notebook
    </title>

    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="format-detection" content="telephone=no"/>
    <meta name="theme-color" content="#0097A7">
    <meta name="author" content="Aryb1n">
    <meta name="description" itemprop="description" content="">
    <meta name="keywords" content=",pwn,学习">

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(key){try{localStorage.removeItem(key)}catch(e){}};lsloader.setLS=function(key,val){try{localStorage.setItem(key,val)}catch(e){}};lsloader.getLS=function(key){var val="";try{val=localStorage.getItem(key)}catch(e){val=""}return val};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var keys=[];for(var i=0;i<localStorage.length;i++){keys.push(localStorage.key(i))}keys.forEach(function(key){var data=lsloader.getLS(key);if(window.oldVersion){var remove=window.oldVersion.reduce(function(p,c){return p||data.indexOf("/*"+c+"*/")!==-1},false);if(remove){lsloader.removeLS(key)}}})}catch(e){}};lsloader.clean();lsloader.load=function(jsname,jspath,cssonload,isJs){if(typeof cssonload==="boolean"){isJs=cssonload;cssonload=undefined}isJs=isJs||false;cssonload=cssonload||function(){};var code;code=this.getLS(jsname);if(code&&code.indexOf(versionString)===-1){this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}if(code){var versionNumber=code.split(versionString)[0];if(versionNumber!=jspath){console.log("reload:"+jspath);this.removeLS(jsname);this.requestResource(jsname,jspath,cssonload,isJs);return}code=code.split(versionString)[1];if(isJs){this.jsRunSequence.push({name:jsname,code:code});this.runjs(jspath,jsname,code)}else{document.getElementById(jsname).appendChild(document.createTextNode(code));cssonload()}}else{this.requestResource(jsname,jspath,cssonload,isJs)}};lsloader.requestResource=function(name,path,cssonload,isJs){var that=this;if(isJs){this.iojs(path,name,function(path,name,code){that.setLS(name,path+versionString+code);that.runjs(path,name,code)})}else{this.iocss(path,name,function(code){document.getElementById(name).appendChild(document.createTextNode(code));that.setLS(name,path+versionString+code)},cssonload)}};lsloader.iojs=function(path,jsname,callback){var that=this;that.jsRunSequence.push({name:jsname,code:""});try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(path,jsname,xhr.response);return}}that.jsfallback(path,jsname)}};xhr.send(null)}catch(e){that.jsfallback(path,jsname)}};lsloader.iocss=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.iofonts=function(path,jsname,callback,cssonload){var that=this;try{var xhr=new XMLHttpRequest;xhr.open("get",path,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){callback(xhr.response);cssonload();return}}that.cssfallback(path,jsname,cssonload)}};xhr.send(null)}catch(e){that.cssfallback(path,jsname,cssonload)}};lsloader.runjs=function(path,name,code){if(!!name&&!!code){for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code=code}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var script=document.createElement("script");script.appendChild(document.createTextNode(this.jsRunSequence[0].code));script.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(script);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var that=this;var script=document.createElement("script");script.src=this.jsRunSequence[0].path;script.type="text/javascript";this.jsRunSequence[0].status="loading";script.onload=function(){that.jsRunSequence.shift();if(that.jsRunSequence.length>0){that.runjs()}};document.body.appendChild(script)}};lsloader.tagLoad=function(path,name){this.jsRunSequence.push({name:name,code:"",path:path,status:"failed"});this.runjs()};lsloader.jsfallback=function(path,name){if(!!this.jsnamemap[name]){return}else{this.jsnamemap[name]=name}for(var k in this.jsRunSequence){if(this.jsRunSequence[k].name==name){this.jsRunSequence[k].code="";this.jsRunSequence[k].status="failed";this.jsRunSequence[k].path=path}}this.runjs()};lsloader.cssfallback=function(path,name,cssonload){if(!!this.cssnamemap[name]){return}else{this.cssnamemap[name]=1}var link=document.createElement("link");link.type="text/css";link.href=path;link.rel="stylesheet";link.onload=link.onerror=cssonload;var root=document.getElementsByTagName("script")[0];root.parentNode.insertBefore(link,root)};lsloader.runInlineScript=function(scriptId,codeId){var code=document.getElementById(codeId).innerText;this.jsRunSequence.push({name:scriptId,code:code});this.runjs()};lsloader.loadCombo=function(jslist){var updateList="";var requestingModules={};for(var k in jslist){var LS=this.getLS(jslist[k].name);if(!!LS){var version=LS.split(versionString)[0];var code=LS.split(versionString)[1]}else{var version=""}if(version==jslist[k].path){this.jsRunSequence.push({name:jslist[k].name,code:code,path:jslist[k].path})}else{this.jsRunSequence.push({name:jslist[k].name,code:null,path:jslist[k].path,status:"comboloading"});requestingModules[jslist[k].name]=true;updateList+=(updateList==""?"":";")+jslist[k].path}}var that=this;if(!!updateList){var xhr=new XMLHttpRequest;xhr.open("get",combo+updateList,true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status>=200&&xhr.status<300||xhr.status==304){if(xhr.response!=""){that.runCombo(xhr.response,requestingModules);return}}else{for(var i in that.jsRunSequence){if(requestingModules[that.jsRunSequence[i].name]){that.jsRunSequence[i].status="failed"}}that.runjs()}}};xhr.send(null)}this.runjs()};lsloader.runCombo=function(comboCode,requestingModules){comboCode=comboCode.split("/*combojs*/");comboCode.shift();for(var k in this.jsRunSequence){if(!!requestingModules[this.jsRunSequence[k].name]&&!!comboCode[0]){this.jsRunSequence[k].status="comboJS";this.jsRunSequence[k].code=comboCode[0];this.setLS(this.jsRunSequence[k].name,this.jsRunSequence[k].path+versionString+comboCode[0]);comboCode.shift()}}this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/favicon-new.png">
    <link rel="icon" sizes="192x192" href="/img/favicon-new.png">
    <link rel="apple-touch-icon" href="/img/favicon-new.png">

    <!--iOS -->
    <meta name="apple-mobile-web-app-title" content="Title">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="480">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Aryb1n&#39;s notebook">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/material.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/css/style.min.css",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #00838F;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #0097A7 !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #0097A7 !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #0097A7 !important;
  }

  .toTop {
    background: #757575 !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #757575;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #757575;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #757575;
  }

  .post-toc a:hover {
    color: #00838F;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(/img/bg.jpg);
      }
    </style>




<!-- Fade Effect -->

    <style>
      .fade {
        transition: all 800ms linear;
        -webkit-transform: translate3d(0,0,0);
        -moz-transform: translate3d(0,0,0);
        -ms-transform: translate3d(0,0,0);
        -o-transform: translate3d(0,0,0);
        transform: translate3d(0,0,0);
        opacity: 1;
      }

      .fade.out{
        opacity: 0;
      }
    </style>


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icon -->

    <style>
        @font-face {
            font-family: 'Material Icons';
            font-style: normal;
            font-weight: 400;
            src: local('Material Icons'),
            local('MaterialIcons-Regular'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff2) format('woff2'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.woff) format('woff'),
            url(https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/fonts/MaterialIcons-Regular.ttf) format('truetype');
        }
    </style>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js", true)</script>
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://yoursite.com">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="pwn | trick | Aryb1n&#39;s notebook">
    <meta property="og:image" content="http://yoursite.com/img/favicon-new.png" />
    <meta property="og:description" content="">
    <meta property="og:article:tag" content="pwn"> <meta property="og:article:tag" content="学习"> 

    
        <meta property="article:published_time" content="Sat Jan 20 2018 11:29:46 GMT+0800" />
        <meta property="article:modified_time" content="Sat Jul 07 2018 22:24:41 GMT+0800" />
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:title" content="pwn | trick | Aryb1n&#39;s notebook">
    <meta name="twitter:description" content="">
    <meta name="twitter:image" content="http://yoursite.com/img/favicon-new.png">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="http://yoursite.com" />

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://yoursite.com/2018/01/20/pwn-trick/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://yoursite.com/2018/01/20/pwn-trick/index.html",
    "headline": "pwn | trick",
    "datePublished": "Sat Jan 20 2018 11:29:46 GMT+0800",
    "dateModified": "Sat Jul 07 2018 22:24:41 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Aryb1n",
        "image": {
            "@type": "ImageObject",
            "url": "/img/avatar.png"
        },
        "description": "天道酬勤, 厚德载物"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Aryb1n&#39;s notebook",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/favicon-new.png"
        }
    },
    "keywords": ",pwn,学习",
    "description": "",
}
</script>


    

    <!-- Analytics -->
    
    
    

    <!-- Custom Head -->
    

<link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ROPGadget里的only"><span class="post-toc-number">1.</span> <span class="post-toc-text">ROPGadget里的only</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#21字节shellcode"><span class="post-toc-number">2.</span> <span class="post-toc-text">21字节shellcode</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#更改执行流程"><span class="post-toc-number">3.</span> <span class="post-toc-text">更改执行流程</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#emmmm"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">emmmm</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#常识"><span class="post-toc-number">4.</span> <span class="post-toc-text">常识</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#利用leave伪造栈帧"><span class="post-toc-number">5.</span> <span class="post-toc-text">利用leave伪造栈帧</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#libc-csu-init处的gadget"><span class="post-toc-number">6.</span> <span class="post-toc-text">libc_csu_init处的gadget</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MK-FP"><span class="post-toc-number">7.</span> <span class="post-toc-text">MK_FP</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#堆方向大概是这样子的"><span class="post-toc-number">8.</span> <span class="post-toc-text">堆方向大概是这样子的</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#实际堆块大小"><span class="post-toc-number">9.</span> <span class="post-toc-text">实际堆块大小</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#fast-bin-大小"><span class="post-toc-number">10.</span> <span class="post-toc-text">fast bin 大小</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#FIFO-amp-LIFO"><span class="post-toc-number">11.</span> <span class="post-toc-text">FIFO & LIFO</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#checksec"><span class="post-toc-number">12.</span> <span class="post-toc-text">checksec</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hint"><span class="post-toc-number">13.</span> <span class="post-toc-text">hint</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#新的unlink的利用方法-传说中的unlink"><span class="post-toc-number">14.</span> <span class="post-toc-text">新的unlink的利用方法(传说中的unlink)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#unlink"><span class="post-toc-number">15.</span> <span class="post-toc-text">unlink</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#总觉UAF和double-free哪里很像"><span class="post-toc-number">16.</span> <span class="post-toc-text">总觉UAF和double free哪里很像</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#很多天了-没搞清楚这个unlink的double-free"><span class="post-toc-number">17.</span> <span class="post-toc-text">很多天了, 没搞清楚这个unlink的double free</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#贴一篇关于堆-感觉挺好的"><span class="post-toc-number">18.</span> <span class="post-toc-text">贴一篇关于堆, 感觉挺好的</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#格式化字符串"><span class="post-toc-number">19.</span> <span class="post-toc-text">格式化字符串</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#有的时候不能想当然"><span class="post-toc-number">20.</span> <span class="post-toc-text">有的时候不能想当然</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#这样子一段"><span class="post-toc-number">21.</span> <span class="post-toc-text">这样子一段</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#格式化字符串-1"><span class="post-toc-number">22.</span> <span class="post-toc-text">格式化字符串</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#任意地址读"><span class="post-toc-number">22.1.</span> <span class="post-toc-text">任意地址读</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#任意地址写"><span class="post-toc-number">22.2.</span> <span class="post-toc-text">任意地址写</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#资料"><span class="post-toc-number">22.3.</span> <span class="post-toc-text">资料</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#IDA相关"><span class="post-toc-number">23.</span> <span class="post-toc-text">IDA相关</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#生成器"><span class="post-toc-number">24.</span> <span class="post-toc-text">生成器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#leak-libc"><span class="post-toc-number">25.</span> <span class="post-toc-text">leak libc</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#bins-0"><span class="post-toc-number">26.</span> <span class="post-toc-text">bins[0]</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#mem-chunk"><span class="post-toc-number">27.</span> <span class="post-toc-text">mem chunk</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#关于初始化"><span class="post-toc-number">28.</span> <span class="post-toc-text">关于初始化</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#gdb里"><span class="post-toc-number">29.</span> <span class="post-toc-text">gdb里</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#malloc-amp-free"><span class="post-toc-number">30.</span> <span class="post-toc-text">malloc & free</span></a></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Random Thumbnail -->
            <div class="post_thumbnail-random mdl-card__media mdl-color-text--grey-50">
            <script type="text/ls-javascript" id="post-thumbnail-script">
    var randomNum = Math.floor(Math.random() * 19 + 1);

    $('.post_thumbnail-random').attr('data-original', '/img/random/material-' + randomNum + '.png');
    $('.post_thumbnail-random').addClass('lazy');
</script>

        
    
            <p class="article-headline-p">
                pwn | trick
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="/img/avatar.png" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Aryb1n</strong>
        <span>1月 20, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/pwn/">pwn</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/学习/">学习</a>
    </ul>
    

    <!-- Share -->
    <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    

    

    <!-- Share Weibo -->
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    

    <!-- Share Telegram -->
    
</ul>

</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p>今天学pwn…希望能坚持…现在还没有什么trick, 就当一个备忘的板子</p>
<h3 id="ROPGadget里的only"><a href="#ROPGadget里的only" class="headerlink" title="ROPGadget里的only"></a>ROPGadget里的only</h3><p>坑爹啊…铁三的时候用这个<code>--only &#39;int&#39;</code>…只能找到一个<code>int 0x80</code><br>然后碰巧这题里…这个gadget最低位是坏字符用不了…<br>现在才发现,,,,不加这玩意, 随便<code>| grep &#39;int 0x80&#39;</code>能得到一堆…<br>伤…<br>我特么</p>
<h3 id="21字节shellcode"><a href="#21字节shellcode" class="headerlink" title="21字节shellcode"></a>21字节shellcode</h3><p>应该是x86通用的?</p>
<pre class="line-numbers language-python"><code class="language-python">shellcode  <span class="token operator">=</span> <span class="token string">"\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73"</span>
shellcode <span class="token operator">+=</span> <span class="token string">"\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0"</span>
shellcode <span class="token operator">+=</span> <span class="token string">"\x0b\xcd\x80"</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-asm"><code class="language-asm">   0:   31 c9                   xor    ecx,ecx
   2:   f7 e1                   mul    ecx
   4:   51                      push   ecx
   5:   68 2f 2f 73 68          push   0x68732f2f
   a:   68 2f 62 69 6e          push   0x6e69622f
   f:   89 e3                   mov    ebx,esp
  11:   b0 0b                   mov    al,0xb
  13:   cd 80                   int    0x80
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="更改执行流程"><a href="#更改执行流程" class="headerlink" title="更改执行流程"></a>更改执行流程</h3><p>栈溢出, 覆盖返回地址</p>
<p>更改got表, 有的题目是静态链接或者开启<code>full RELRO</code>保护不能写GOT的时候就可以考虑使用malloc_hook</p>
<p>使用malloc_hook, 这个刚刚学到, 在RCTF2017-RNote里, 这题有点神奇, 错位分配fastbin到malloc_hook</p>
<h4 id="emmmm"><a href="#emmmm" class="headerlink" title="emmmm"></a>emmmm</h4><p>有个疑问, 就是静态链接到底可以改got表来劫持流程吗…</p>
<h3 id="常识"><a href="#常识" class="headerlink" title="常识"></a>常识</h3><p>prev是指低地址的, 我智商太低老是反映不过来<br>比如, free的时候, 合并到低地址的空闲chunk是如下操作</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">prev_inuse</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    prevsize <span class="token operator">=</span> <span class="token function">prev_size</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size <span class="token operator">+</span><span class="token operator">=</span> prevsize<span class="token punctuation">;</span>
    p <span class="token operator">=</span> <span class="token function">chunk_at_offset</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> prevsize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">unlink</span><span class="token punctuation">(</span>av<span class="token punctuation">,</span> p<span class="token punctuation">,</span> bck<span class="token punctuation">,</span> fwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>------------------ &lt;- 低地址
prev_size | size
------------------ 
fd      |    bk
------------------ 
not used content
------------------ &lt;- p
prev_size | size
-----------------
Data
-----------------

变成

------------------ &lt;- p
prev_size | size
------------------ 
fd      |    bk
------------------ 
not used content
------------------ &lt;- 原来p的指向

-----------------

-----------------
</code></pre><h3 id="利用leave伪造栈帧"><a href="#利用leave伪造栈帧" class="headerlink" title="利用leave伪造栈帧"></a>利用leave伪造栈帧</h3><pre class="line-numbers language-asm"><code class="language-asm">push ebp
mov  ebp, esp

leave # mov esp, ebp | pop ebp
ret
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这个leave可以改变esp的值, 所以只要伪造一个ebp, 然后跳到一个leave的片段就可以</p>
<pre><code>旧的栈帧
-----------------------------
padding | fake ebp | ret_addr
                        +
                        +--&gt; leave | ret ----------------+
                                +----&gt; esp = fake ebp    |
            +---------------------------+  pop ebp       |
            |                        +---------+         |
            +                        |                   |
伪造的栈帧 esp(原fake ebp)           |     | ret_addr &lt;--+
-------------------------------------+-----+----------
fake ebp2(上一句的leave的后半句要pop ebp)  | fake addr
</code></pre><p>把这里的ret_addr设置为<code>leave; ret</code>的gadget的地址<br>当执行leave这一句的时候, 当前的esp就变为了我们设置的<code>fake ebp</code>, 这个时候下一句的ret就是从我们当前的esp处(我们前面的fake的ebp地址)弹出的地址作为返回地址了, 所以我们还要提前在<code>fake ebp</code>这里写好, 这里就需要我们能有一块知道地址并且可写的地址来放我们的<code>fake ebp</code>指向的区域</p>
<p>应该是适用于那种栈溢出能利用的字节比较少的时候, 对…做了几道题, 发现…这原来叫栈迁移…就一般只能覆盖到ebp和ret的时候可以用这个技巧</p>
<h3 id="libc-csu-init处的gadget"><a href="#libc-csu-init处的gadget" class="headerlink" title="libc_csu_init处的gadget"></a>libc_csu_init处的gadget</h3><p>可以控制大量的寄存器, 常用于64位rop…然后顺手牵一段代码</p>
<h3 id="MK-FP"><a href="#MK-FP" class="headerlink" title="MK_FP"></a>MK_FP</h3><p>一般你看到的MK_FP是用来实现Canary的<br>ida里类似的代码</p>
<pre class="line-numbers language-c"><code class="language-c">v3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">MK_FP</span><span class="token punctuation">(</span>__FS__<span class="token punctuation">,</span> <span class="token number">40LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
v1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">MK_FP</span><span class="token punctuation">(</span>__FS__<span class="token punctuation">,</span> <span class="token number">40LL</span><span class="token punctuation">)</span> <span class="token operator">^</span> v3<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="堆方向大概是这样子的"><a href="#堆方向大概是这样子的" class="headerlink" title="堆方向大概是这样子的"></a>堆方向大概是这样子的</h3><pre><code>+--------------+ 高
+  top chunk   |
+--------------+
+ size of top  |
+--------------+
+ prev size    |
+--------------+
+--------------+
+ chunk0       |
+--------------+
+size of chunk0|
+--------------+
+ prev size    |
+ -------------+ 低
</code></pre><h3 id="实际堆块大小"><a href="#实际堆块大小" class="headerlink" title="实际堆块大小"></a>实际堆块大小</h3><p>以32为例, <code>malloc(size)</code>, 这里是说至少能放得下size大小的data, 那么实际割下来一块<code>((size + 4 + 7) &amp; ~7)</code><br>先说这里的 <code>(size + 4)</code> 这一部分, 因为需要8bit的<code>meta</code>信息, 而又可以使用下一块的4bit的<code>prev_size</code>, 所以元信息只要额外的4bit</p>
<pre><code>----------+-----
prev_size | 4bit
----------+-----
size      | 4bit
----------+-----
chunk     | ?bit
----------+-----
人家的prev_size
----------+-----
</code></pre><p>再说这里的<code>((x + 7) &amp; ~7)</code>, 这个是为了8字节对齐, 明眼人一下就看出来这是个分段函数<br><code>x = 1...8</code>时候<code>f(x) = 8</code>, <code>x = 9...16</code>的时候<code>f(x) = 16</code>, 恩, 就这样子</p>
<p>另外, 32位以8字节对齐, 那64位应该是16字节对齐的?所以就是<code>((size + 8 + 15) &amp; ~15)</code>, ???</p>
<p>对的, 是双字对齐<code>double-word aligned</code></p>
<p>后来, 在读malloc源码的时候看到了…<br>具体对齐的代码是</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> request2size(req)                                         \
  (((req) + SIZE_SZ + MALLOC_ALIGN_MASK &lt; MINSIZE)  ?             \
   MINSIZE :                                                      \
   ((req) + SIZE_SZ + MALLOC_ALIGN_MASK) &amp; ~MALLOC_ALIGN_MASK)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>本来是需要两个额外的size_t来存储头部信息, 但由于可以借用下一个chunk的<code>prev_size</code>, 所以这里只要加一个size_t, 如果是mmap申请的, 就没有办法借用…就需要加<code>2*size_t</code>, 然后再对齐</p>
<h3 id="fast-bin-大小"><a href="#fast-bin-大小" class="headerlink" title="fast bin 大小"></a>fast bin 大小</h3><p>16~64(0x10, 0x40) bytes for x86_32<br>32~128(0x20, 0x80) bytes for x86_64<br>这个大小应该指的是data的大小, 还是总共分的大小<br>这个data是chunk的大小, 不是data的大小</p>
<p>根据上面的计算公式, 这个, 那个32bit下…malloc 大小0x0和0x8的..会得到一个0x10大小的chunk, 也就是最小的chunk</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x10</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x10</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x18</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x20</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x28</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x30</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">48</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x38</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">56</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">-></span> free <span class="token operator">-></span> fastbinY<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0x40</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>实际上这个fastbinY是有10个位置…fastbinY[0..9], 意思是后三个[7..9], 其实是没用上的, 这个可能通过设置来实现?</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span> p3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">free</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">free</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">free</span><span class="token punctuation">(</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对应fastbinY差不多…是这样子的</p>
<pre><code>fastbinY[0] -&gt; &#39;p3&#39; -&gt; &#39;p2&#39; -&gt; &#39;p1&#39; -&gt; NULL
</code></pre><p>等再分配的时候, 会把<code>p3</code>先unlink出去, 然后是<code>p2</code>, <code>p1</code><br>相当于是栈, LIFO, 但怎么感觉哪里怪怪的…这个栈顶在<code>fastbinY[?]</code></p>
<p>而对于普通的bins, 是这样子</p>
<pre><code>bins[0] -&gt; 0x604940 -&gt; 0x604820
           后入后出    先入先出
</code></pre><p>进入的方向和fastbins是一样的, 但出去的方向是不一样的</p>
<p>普通的bin有很多…大概是…126 这么多…而且bins是双向链表, 一个位要占两个格子</p>
<pre><code>1 unsorted bin
62 small bin
63 large bin
</code></pre><p>那我怎么感觉, 调试的时候在最后一个bins和binmap时间有8字节的padding呢…</p>
<h3 id="FIFO-amp-LIFO"><a href="#FIFO-amp-LIFO" class="headerlink" title="FIFO &amp; LIFO"></a>FIFO &amp; LIFO</h3><p>fastbins是先进后出, 像栈一样<br>其他的bins都是先进先出, 像队列一样</p>
<h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><p>FULL RELRO之后就不能改写got表了</p>
<h3 id="hint"><a href="#hint" class="headerlink" title="hint"></a>hint</h3><p>UAF 用来leak堆上的信息, 然后计算一些地址</p>
<p>double free用来利用unlink漏洞(以前glibc的unlink没有检查, 只需要一次free就可以利用了) 看到某人写到double free的核心在于第二次free的时候发生的unlink, 虽然叫double free, 但其实只要是free一个指向堆内存的指针都有可能产生可以利用的漏洞, 我觉得看了很多还是这一篇讲述的清楚 <a href="http://www.cnblogs.com/elvirangel/p/7203540.html" target="_blank" rel="external">http://www.cnblogs.com/elvirangel/p/7203540.html</a></p>
<p>注意了…bins里的size字段存储的是<code>prev_size + size + data</code>的长度, 不是data的长度, 只有这样子才能通过size字段来找到下一块啊….</p>
<h3 id="新的unlink的利用方法-传说中的unlink"><a href="#新的unlink的利用方法-传说中的unlink" class="headerlink" title="新的unlink的利用方法(传说中的unlink)"></a>新的unlink的利用方法(传说中的unlink)</h3><pre><code>|&lt;-------------------p1-------------------------&gt;|&lt;-----p2------&gt;
+-----------+------+-----------------------------+----------------+
| prev_size | size |fake_prev|fake_size|fake_data|prev|size|data  |
+-----------+------+-----------------------------+----------------+
                   |&lt;-----fake出来的堆块--------&gt;|&lt;-溢出时fake一下|
</code></pre><p>通过p1的堆溢出来在p1的数据部分fake一个堆, 同时对p2的下一块的prev(改成fake出来堆块的大小)和size(主要是标志位)进行修改, 让系统以为p1已经空闲, 然后在<code>free(p2)</code>的时候就可以对p1进行unlink, 这个时候就要注意fake出来的堆块的构造方式, 主要是fake_fd和fake_bk….</p>
<p>Unlink有很多中利用方式, 就是有不同的构造方式, 这里是用overflow的方法, 也可以用overlap的方法, 强网杯补题里有说..</p>
<h3 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h3><p>double free的经典题目<code>0ctf2015-freenote</code>的wp很多, 但我感觉这一篇真棒, 有图真好, <a href="http://angelboy.logdown.com/posts/259180-0ctf-2015-write-up" target="_blank" rel="external">http://angelboy.logdown.com/posts/259180-0ctf-2015-write-up</a><br><a href="http://rk700.github.io/2015/04/21/0ctf-freenote/" target="_blank" rel="external">http://rk700.github.io/2015/04/21/0ctf-freenote/</a></p>
<h3 id="总觉UAF和double-free哪里很像"><a href="#总觉UAF和double-free哪里很像" class="headerlink" title="总觉UAF和double free哪里很像"></a>总觉UAF和double free哪里很像</h3><p>问题终结…<br>在某大佬的PPT里说…<br>Double Free算是一种特殊的UAF</p>
<h3 id="很多天了-没搞清楚这个unlink的double-free"><a href="#很多天了-没搞清楚这个unlink的double-free" class="headerlink" title="很多天了, 没搞清楚这个unlink的double free"></a>很多天了, 没搞清楚这个unlink的double free</h3><p>在unlink一个块, 我们叫他<code>p = 0x604800</code>的时候是(64位为例)<br>用方块代表取一个地址里的东西</p>
<pre><code>BK = p -&gt; bk
   BK = [0x604800 + 0x18] = 0x604900
FD = p -&gt; fd
   FD = [0x604800 + 0x10] = 0x604700
然后
BK -&gt; fd = FD -&gt; bk
   [0x604700 + 0x18] = [0x604900 + 0x10] 
   [0x604900 + 0x10] = [0x604700 + 0x18]
</code></pre><p>我已经崩坏了….</p>
<p>double link的时候, ptr是找到一个地址指向我们要unlink的块, 而不是 <code>ptr == p</code>. 是<code>*ptr == p</code>,(p是我们unlink的时候要释放的fake出来的块), 理解错误之一<br>unlink的时候这个会发生一次赋值<del><code>ptr = p - 0x18</code></del>, 这里是我理解的最大错误之二, 应该是<code>*ptr = ptr - 3</code><br>然后如果能对ptr里存的地址所指向的位置进行写的话, 就可以写到<code>ptr - 3</code>的地方<br>现在才懂这个图是啥意思 <a href="http://www.cnblogs.com/0xJDchen/p/6195919.html" target="_blank" rel="external">http://www.cnblogs.com/0xJDchen/p/6195919.html</a><br>然后对 <code>note[0] -&gt; content</code> (我们上面的ptr)进行写入的话, 其实就是写到了<code>ptr - 0xc</code>这个地址, 因为<code>ptr - 0x18</code>这个地址位于<code>ptr</code>的上方, 所以这样子就能重新覆盖掉ptr, 比如把ptr里的内容覆盖成<code>free@got</code>,<br>我怕是个傻子</p>
<p>妈的, 终于懂了</p>
<h3 id="贴一篇关于堆-感觉挺好的"><a href="#贴一篇关于堆-感觉挺好的" class="headerlink" title="贴一篇关于堆, 感觉挺好的"></a>贴一篇关于堆, 感觉挺好的</h3><p><a href="https://paper.seebug.org/255/" target="_blank" rel="external">https://paper.seebug.org/255/</a></p>
<h3 id="格式化字符串"><a href="#格式化字符串" class="headerlink" title="格式化字符串"></a>格式化字符串</h3><p>看这个 <a href="https://paper.seebug.org/246/" target="_blank" rel="external">https://paper.seebug.org/246/</a><br>当格式化字符串存储在bss, 堆上的时候怎么办<br>当格式化字符串使用不同函数接收时候的字符限制<br>当开启保护不能改got表怎么办 -&gt; 改stdin虚表</p>
<h3 id="有的时候不能想当然"><a href="#有的时候不能想当然" class="headerlink" title="有的时候不能想当然"></a>有的时候不能想当然</h3><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">func1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">func2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>我看到这个的时候一般认为, 局部变量a应该是先进行分配, 所以处于更高的位置, buffer位于低一些的位置, 更靠近func2的调用堆栈, 其实呢, 编译发现…gcc可能会对局部变量的位置进行调整, 就像这里, 我看到的是 buffer 更高, 所以不能YY, 要自己看编译后的结果…毕竟不知道编译的时候gcc对程序做了什么优化对齐啊什么什么的</p>
<h3 id="这样子一段"><a href="#这样子一段" class="headerlink" title="这样子一段"></a>这样子一段</h3><pre class="line-numbers language-c"><code class="language-c"><span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token function">alarm</span><span class="token punctuation">(</span><span class="token number">0x3Cu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>对这个setvbuf还是不太懂<br>后来…偶然调试了一下…<br>如果不setbuf的话…在用printf, scanf输入输出的时候会在堆上申请内存来作为输入输出缓冲区<br>调试发现, 第一次用printf会产生一个0x400(1024)大小的缓冲区, 如果加上<code>setvbuf(stdout, 0, 2, 0)</code>就不会产生这个缓冲区<br>scanf同理, 也会产生一个<br>那么如果取消缓冲区的话….那他们怎么缓冲呢QwQ</p>
<h3 id="格式化字符串-1"><a href="#格式化字符串-1" class="headerlink" title="格式化字符串"></a>格式化字符串</h3><p>test使用<code>AAAA.%1$p.%2$p...</code>这样子的</p>
<h4 id="任意地址读"><a href="#任意地址读" class="headerlink" title="任意地址读"></a>任意地址读</h4><p>确定位置之后,比如是<code>%3$p</code>, 使用<code>addr.%3$s</code>来任意地址读…我这里写了个题, 利用格式化字符串来DynELF…结果失败了,QAQ, 不知道为啥</p>
<h4 id="任意地址写"><a href="#任意地址写" class="headerlink" title="任意地址写"></a>任意地址写</h4><p>可以用pwntools带的fmtstr_payload…</p>
<h4 id="资料"><a href="#资料" class="headerlink" title="资料"></a>资料</h4><p><a href="https://paper.seebug.org/246/" target="_blank" rel="external">https://paper.seebug.org/246/</a></p>
<h3 id="IDA相关"><a href="#IDA相关" class="headerlink" title="IDA相关"></a>IDA相关</h3><p>就写在这里吧…<br>IDA栈帧表示</p>
<pre><code>-0000000000000008                 db ? ; undefined
-0000000000000007                 db ? ; undefined
-0000000000000006                 db ? ; undefined
-0000000000000005                 db ? ; undefined
-0000000000000004 var_4           dd ?
+0000000000000000  s              db 8 dup(?)
+0000000000000008  r              db 8 dup(?)
</code></pre><p>这个s是saved的ebp, r是返回地址ret</p>
<h3 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h3><p>经常用的</p>
<pre class="line-numbers language-python"><code class="language-python">libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./libc32"</span><span class="token punctuation">)</span>
list<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true"># 写法一</span>
libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 写法二</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这个<code>libc.search()</code> 返回的就是一个<code>generator</code>, 大概用法</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    x <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">yield</span> x
        x <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token comment" spellcheck="true"># 用法1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> gen<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    do sth<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment" spellcheck="true"># 用法1</span>
g <span class="token operator">=</span> gen<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> g<span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> g<span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> g<span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="leak-libc"><a href="#leak-libc" class="headerlink" title="leak libc"></a>leak libc</h3><p>因为fastbin是单链表, 所以要其他bin才能leak出main_area, 从而算出来libc地址</p>
<h3 id="bins-0"><a href="#bins-0" class="headerlink" title="bins[0]"></a>bins[0]</h3><p><code>bins[0]</code>貌似是没有意义的…</p>
<p>因为在<code>malloc_init_state</code>中…这样子写道</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">malloc_init_state</span> <span class="token punctuation">(</span>mstate av<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    mbinptr bin<span class="token punctuation">;</span>
    <span class="token comment" spellcheck="true">/* Establish circular links for normal bins */</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> NBINS<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        bin <span class="token operator">=</span> <span class="token function">bin_at</span> <span class="token punctuation">(</span>av<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        bin<span class="token operator">-></span>fd <span class="token operator">=</span> bin<span class="token operator">-></span>bk <span class="token operator">=</span> bin<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里的<code>bin_at</code>是</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token comment" spellcheck="true">/* addressing -- note that bin_at(0) does not exist */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> bin_at(m, i) \
  (mbinptr) (((char *) &amp;((m)->bins[((i) - 1) * 2]))                              \
             - offsetof (struct malloc_chunk, fd))</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>喔…不对…我的理解好像出现了偏差…</p>
<h3 id="mem-chunk"><a href="#mem-chunk" class="headerlink" title="mem chunk"></a>mem chunk</h3><p>malloc里把malloc和free的的指针, 称mem, 即不包含chunk的头部的<code>prev_size</code>和<code>size</code><br>在进入<code>__libc_free</code>时, 会把传入的<code>mem</code>用<code>mem2chunk</code>转为<code>chunk</code><br>其中, <code>mem2chunk</code>是</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> mem2chunk(mem) ((mchunkptr)((char*)(mem) - 2*SIZE_SZ))</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>对应的<code>chunk2mem</code>为</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> chunk2mem(p)   ((void*)((char*)(p) + 2*SIZE_SZ))</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h3 id="关于初始化"><a href="#关于初始化" class="headerlink" title="关于初始化"></a>关于初始化</h3><p>初始化之后…<br>fastbinsY[0…9] 都为 0<br>bins  并不是为0, 而是会指向自身, 所以是是可以通过这个leak出main_area的地址</p>
<pre class="line-numbers language-python"><code class="language-python">gdb<span class="token operator">-</span>peda$ p main_arena 
$<span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  mutex <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">,</span> 
  flags <span class="token operator">=</span> <span class="token number">0x1</span><span class="token punctuation">,</span> 
  fastbinsY <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">,</span> <span class="token number">0x0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> 
  top <span class="token operator">=</span> <span class="token number">0x804b070</span><span class="token punctuation">,</span> 
  last_remainder <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">,</span> 
  bins <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0xf7f977b0</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">48</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token number">0xf7f977b0</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">48</span><span class="token operator">></span><span class="token punctuation">,</span> 
    <span class="token number">0xf7f977b8</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">56</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token number">0xf7f977b8</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">56</span><span class="token operator">></span><span class="token punctuation">,</span> 
    <span class="token number">0xf7f977c0</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token number">0xf7f977c0</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">64</span><span class="token operator">></span><span class="token punctuation">,</span> 
    <span class="token number">0xf7f977c8</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">72</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token number">0xf7f977c8</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">72</span><span class="token operator">></span><span class="token punctuation">,</span> 
    <span class="token number">0xf7f977d0</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">80</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token number">0xf7f977d0</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">80</span><span class="token operator">></span><span class="token punctuation">,</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>真是醉了….<br>说是unsorted_bin是bin[1]…然而</p>
<pre class="line-numbers language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">define</span> unsorted_chunks(M) (bin_at(M, 1))</span>

<span class="token macro property">#<span class="token directive keyword">define</span> bin_at(m, i) \
(mbinptr) (((char *) &amp;((m)->bins[((i) - 1) * 2])) \
- offsetof (struct malloc_chunk, fd))</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>带进去算一下就可以知道…其实是 <code>main_arena -&gt; bins[0]</code> 存的就是<code>unsorted_bin</code>的<code>fd</code>, <code>main_arena -&gt; bins[1]</code>存的就是<code>unsorted_bin</code>的<code>bk</code></p>
<h3 id="gdb里"><a href="#gdb里" class="headerlink" title="gdb里"></a>gdb里</h3><pre class="line-numbers language-c"><code class="language-c">gdb<span class="token operator">-</span>peda$ p <span class="token operator">*</span><span class="token punctuation">(</span>mfastbinptr<span class="token punctuation">)</span><span class="token number">0x804b000</span>
$<span class="token number">5</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  prev_size <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">,</span> 
  size <span class="token operator">=</span> <span class="token number">0x91</span><span class="token punctuation">,</span> 
  fd <span class="token operator">=</span> <span class="token number">0xf7f97838</span> <span class="token operator">&lt;</span>main_arena<span class="token operator">+</span><span class="token number">184</span><span class="token operator">></span><span class="token punctuation">,</span> 
  bk <span class="token operator">=</span> <span class="token number">0x804b0a0</span><span class="token punctuation">,</span> 
  fd_nextsize <span class="token operator">=</span> <span class="token number">0x41414141</span><span class="token punctuation">,</span> 
  bk_nextsize <span class="token operator">=</span> <span class="token number">0x41414141</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="malloc-amp-free"><a href="#malloc-amp-free" class="headerlink" title="malloc &amp; free"></a>malloc &amp; free</h3><p><code>_int_malloc</code></p>
<ol>
<li>是否fastbin, 看是否有合适大小的fastbin</li>
<li>是否smallbin, 看是否有合适大小的fastbin</li>
<li>如果没有合适的fastbin和smallbin, 就进行<code>consolidate fastbin -&gt; unsorted_bin</code></li>
<li>开始大循环</li>
</ol>
<p>如果…<code>unsorted_bin</code>中只有一个<code>last_remainder</code>.并且大小足够分, 就把这一块分一半给用户, 剩下的一块就是新的<code>last_remainder</code>, 再重新放入<code>unsorted_bin</code>…</p>
<p>大循环:<br>    反向寻找<code>unsorted_bin</code>, 最多找1w次…<br>    大小精确相等的, 就可以直接分配<br>    如果当前块是small bins, 就放到对应大小的smallbin的第一个位置<br>    如果是large bins, 就放到largebin的合适位置(因为large是一个范围, 大小排序好的)</p>
<p>所以…small_bin和large_bin都是从unsorted_bin取出来放进去的…</p>
<p>明天再写…这个循环有点迷</p>
<p><code>_int_free</code></p>
<ol>
<li>是否fastbin</li>
<li>是否mmap分配的, 如果是就用munmap</li>
<li>不然的话, 即使非mmap分配的small或者large, 就放入unsorted_bin</li>
</ol>
<p>free这里主要是各种检查</p>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/03/08/issue-SwitchyOmega的auto-witch/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/01/09/dns-trick积累/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(/img/sidebar_header.png);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="/img/avatar.png" alt="Aryb1n's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        841010857@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2019/03/">三月 2019<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/12/">十二月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/09/">九月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/07/">七月 2018<span class="sidebar_archives-count">18</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/06/">六月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">11</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">12</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">10</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">7</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/09/">九月 2017<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/08/">八月 2017<span class="sidebar_archives-count">16</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">38</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/05/">五月 2017<span class="sidebar_archives-count">52</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/04/">四月 2017<span class="sidebar_archives-count">26</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/03/">三月 2017<span class="sidebar_archives-count">13</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/02/">二月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/01/">一月 2017<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/11/">十一月 2016<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/10/">十月 2016<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/09/">九月 2016<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2016/07/">七月 2016<span class="sidebar_archives-count">13</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">chrome_reader_mode</i>
                
                分类
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
                <li>
                <a class="sidebar_archives-link" href="/categories/issue/">issue<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/categories/pwn/">pwn<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/trick/">trick<span class="sidebar_archives-count">8</span></a></li><li><a class="sidebar_archives-link" href="/categories/writeup/">writeup<span class="sidebar_archives-count">27</span></a></li><li><a class="sidebar_archives-link" href="/categories/writeup/学习/">学习<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/咸鱼/">咸鱼<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/categories/备忘/">备忘<span class="sidebar_archives-count">6</span></a></li><li><a class="sidebar_archives-link" href="/categories/学习/">学习<span class="sidebar_archives-count">35</span></a></li><li><a class="sidebar_archives-link" href="/categories/日记/">日记<span class="sidebar_archives-count">9</span></a></li><li><a class="sidebar_archives-link" href="/categories/笔记/">笔记<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签">
                
                    <i class="material-icons sidebar-material-icons">label</i>
                
                标签
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友链">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                友链
            </a>
        </li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->


<!-- Theme Material -->


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Aryb1n's notebook
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/lazyload.min.js", true)</script>



    <script>lsloader.load("js_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/js.min.js", true)</script>



    <script>lsloader.load("np_js","https://cdn.jsdelivr.net/npm/hexo-material@1.4.0/source/js/nprogress.js", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>













<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.0 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
